(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6195024c"],{"0f5f":function(e,t,n){(function(t,n){e.exports=n()})(0,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";var o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports={type:function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},isObject:function(e,t){return t?"object"===this.type(e):e&&"object"===("undefined"===typeof e?"undefined":o(e))},isFormData:function(e){return"undefined"!==typeof FormData&&e instanceof FormData},trim:function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},encode:function(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")},formatParams:function(e){var t="",n=!0,o=this;if(!this.isObject(e))return e;function a(e,r){var i=o.encode,s=o.type(e);if("array"==s)e.forEach(function(e,t){o.isObject(e)||(t=""),a(e,r+"%5B"+t+"%5D")});else if("object"==s)for(var c in e)a(e[c],r?r+"%5B"+i(c)+"%5D":i(c));else n||(t+="&"),n=!1,t+=r+"="+i(e)}return a(e,""),t},merge:function(e,t){for(var n in t)e.hasOwnProperty(n)?this.isObject(t[n],1)&&this.isObject(e[n],1)&&this.merge(e[n],t[n]):e[n]=t[n];return e}}},,function(e,t,n){var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=n(0),i="undefined"!==typeof document,s=function(){function e(t){function n(e){var t=void 0,n=void 0;function o(){e.p=t=n=null}r.merge(e,{lock:function(){t||(e.p=new Promise(function(e,o){t=e,n=o}))},unlock:function(){t&&(t(),o())},clear:function(){n&&(n("cancel"),o())}})}a(this,e),this.engine=t||XMLHttpRequest,this.default=this;var o=this.interceptors={response:{use:function(e,t){this.handler=e,this.onerror=t}},request:{use:function(e){this.handler=e}}},i=o.request,s=o.response;n(s),n(i),this.config={method:"GET",baseURL:"",headers:{},timeout:0,params:{},parseJson:!0,withCredentials:!1}}return o(e,[{key:"request",value:function(e,t,n){var o=this,a=new this.engine,s="Content-Type",c=s.toLowerCase(),u=this.interceptors,l=u.request,f=u.response,d=l.handler,p=new Promise(function(u,p){function h(e){return e&&e.then&&e.catch}function m(e,t){e?e.then(function(){t()}):t()}function v(n){t=n.body,e=r.trim(n.url);var o=r.trim(n.baseURL||"");if(e||!i||o||(e=location.href),0!==e.indexOf("http")){var l="/"===e[0];if(!o&&i){var d=location.pathname.split("/");d.pop(),o=location.protocol+"//"+location.host+(l?"":d.join("/"))}if("/"!==o[o.length-1]&&(o+="/"),e=o+(l?e.substr(1):e),i){var v=document.createElement("a");v.href=e,e=v.href}}var g=r.trim(n.responseType||""),b=-1!==["GET","HEAD","DELETE","OPTION"].indexOf(n.method),w=r.type(t),y=n.params||{};b&&"object"===w&&(y=r.merge(t,y)),y=r.formatParams(y);var O=[];y&&O.push(y),b&&t&&"string"===w&&O.push(t),O.length>0&&(e+=(-1===e.indexOf("?")?"?":"&")+O.join("&")),a.open(n.method,e);try{a.withCredentials=!!n.withCredentials,a.timeout=n.timeout||0,"stream"!==g&&(a.responseType=g)}catch(T){}var _=n.headers[s]||n.headers[c],j="application/x-www-form-urlencoded";for(var k in r.trim((_||"").toLowerCase())===j?t=r.formatParams(t):r.isFormData(t)||-1===["object","array"].indexOf(r.type(t))||(j="application/json;charset=utf-8",t=JSON.stringify(t)),_||b||(n.headers[s]=j),n.headers)if(k===s&&r.isFormData(t))delete n.headers[k];else try{a.setRequestHeader(k,n.headers[k])}catch(T){}function x(e,t,o){m(f.p,function(){if(e){o&&(t.request=n);var a=e.call(f,t,Promise);t=void 0===a?t:a}h(t)||(t=Promise[0===o?"resolve":"reject"](t)),t.then(function(e){u(e)}).catch(function(e){p(e)})})}function D(e){e.engine=a,x(f.onerror,e,-1)}function C(e,t){this.message=e,this.status=t}a.onload=function(){try{var e=a.response||a.responseText;e&&n.parseJson&&-1!==(a.getResponseHeader(s)||"").indexOf("json")&&!r.isObject(e)&&(e=JSON.parse(e));var t=a.responseHeaders;if(!t){t={};var o=(a.getAllResponseHeaders()||"").split("\r\n");o.pop(),o.forEach(function(e){if(e){var n=e.split(":")[0];t[n]=a.getResponseHeader(n)}})}var i=a.status,c=a.statusText,u={data:e,headers:t,status:i,statusText:c};if(r.merge(u,a._response),i>=200&&i<300||304===i)u.engine=a,u.request=n,x(f.handler,u,0);else{var l=new C(c,i);l.response=u,D(l)}}catch(l){D(new C(l.msg,a.status))}},a.onerror=function(e){D(new C(e.msg||"Network Error",0))},a.ontimeout=function(){D(new C("timeout [ "+a.timeout+"ms ]",1))},a._options=n,setTimeout(function(){a.send(b?null:t)},0)}r.isObject(e)&&(n=e,e=n.url),n=n||{},n.headers=n.headers||{},m(l.p,function(){r.merge(n,JSON.parse(JSON.stringify(o.config)));var a=n.headers;a[s]=a[s]||a[c]||"",delete a[c],n.body=t||n.body,e=r.trim(e||""),n.method=n.method.toUpperCase(),n.url=e;var i=n;d&&(i=d.call(l,n,Promise)||n),h(i)||(i=Promise.resolve(i)),i.then(function(e){e===n?v(e):u(e)},function(e){p(e)})})});return p.engine=a,p}},{key:"all",value:function(e){return Promise.all(e)}},{key:"spread",value:function(e){return function(t){return e.apply(null,t)}}}]),e}();s.default=s,["get","post","put","patch","head","delete"].forEach(function(e){s.prototype[e]=function(t,n,o){return this.request(t,n,r.merge({method:e},o))}}),["lock","unlock","clear"].forEach(function(e){s.prototype[e]=function(){this.interceptors.request[e]()}}),e.exports=s}])})},a648:function(e,t,n){"use strict";n.r(t);var o,a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("van-dialog",{attrs:{title:"正在下载中",showConfirmButton:!1},model:{value:e.showLoadingDialog,callback:function(t){e.showLoadingDialog=t},expression:"showLoadingDialog"}}),e._l(e.works,function(t){return n("van-card",{key:t.tag,attrs:{tag:t.tag+" 号",desc:t.desc,title:t.title,thumb:t.imageURL}},[n("view",{attrs:{slot:"footer"},slot:"footer"},[n("van-button",{staticStyle:{"padding-right":"5px"},attrs:{size:"small",type:"danger",disabled:e.disable_all||t.voted,round:""},on:{click:function(n){return e.show_confirm_vote(t.tag,t.title,e.disable_all,t.voted)}}},[e._v("\n          "+e._s(t.btn_text)+"\n        ")]),n("van-button",{staticStyle:{"padding-left":"5px"},attrs:{size:"small",type:"primary",round:""},on:{click:function(n){return e.show_detail(t.tag)}}},[e._v("查看详情")])],1)])}),n("van-dialog",{attrs:{id:"van-dialog"}}),n("van-dialog",{attrs:{show:e.showContactDialog,"show-cancel-button":"","confirm-button-open-type":"contact",title:"提示",message:e.subname},on:{close:e.onContactDialogClose,cancel:e.onContactDialogClose}}),n("van-action-sheet",{attrs:{show:e.showDetailAction,title:"选择查看详情方式"},on:{close:function(t){return e.onActionClose()}}},[n("view",e._l(e.detailActions,function(t){return n("van-button",{key:t.name,attrs:{size:"large"},on:{click:function(n){return e.onActionSelect(t.name,t.subname)}}},[e._v("\n            "+e._s(t.name)+"\n          ")])}),1)]),n("van-notify",{attrs:{id:"van-notify"}}),n("van-toast",{attrs:{id:"van-toast"}})],2)},r=[],i=n("bd86"),s=(n("ac1e"),n("543e")),c=(n("e7e5"),n("d399")),u=(n("e17f"),n("2241")),l=(n("66b9"),n("b650")),f=(n("9a83"),n("f564")),d=n("2b0e");d["a"].use(f["a"]),d["a"].use(l["a"]),d["a"].use(u["a"]),d["a"].use(c["a"]);var p=n("f54a"),h={components:(o={},Object(i["a"])(o,f["a"].name,f["a"]),Object(i["a"])(o,u["a"].name,u["a"]),Object(i["a"])(o,c["a"].name,c["a"]),Object(i["a"])(o,s["a"].name,s["a"]),o),data:function(){return{showLoadingDialog:!1,deploy_domain:"https://vote.ilingyue.cn",selectedWorkTag:"",showDetailAction:!1,showContactDialog:!1,disable_all:!1,max_votes:3,voted:0,subname:"",works:{}}},props:{userId:String},onLoad:function(e){},mounted:function(){Object(f["a"])("登录成功: "+this.userId);var e=this;p.post(this.deploy_domain+"/getWorks",{userId:this.userId}).then(function(t){if(console.log(t),"success"===t["data"]["code"]){e.works=t["data"]["data"]["works"],e.max_votes=t["data"]["data"]["max_votes"],Object(f["a"])("获取作品成功");var n=0,o=e.works;for(var a in e.works)o[a]["voted"]?(n+=1,o[a]["btn_text"]="已投票"):o[a]["btn_text"]="直接投票";n>=e.max_votes&&(e.disable_all=!0),e.voted=n,e.works=o}else Object(f["a"])("获取作品失败")}).catch(function(e){console.log(e),Object(f["a"])("获取作品失败: "+e)})},computed:{detailActions:function(){return[{name:"pdf 查看",subname:"在小程序内打开作品的 pdf 版本介绍"},{name:"作品链接",subname:"查看作品原始链接"}]}},methods:{show_confirm_vote:function(e,t,n,o){var a=this;n?Object(f["a"])("您已经使用完了所有票数("+this.voted+" 张)"):o?Object(f["a"])("您已经投票了该作品"):u["a"].confirm({title:"确认投票",message:'是否确认为作品 "'+t+'"('+e+") 投票, 投票后不能撤销!"}).then(function(){p.post(a.deploy_domain+"/vote",{user_id:a.userId,tag:e}).then(function(n){console.log(n),Object(f["a"])('作品 "'+t+'"( '+e+") 投票成功")}).catch(function(n){console.log(n),Object(f["a"])('作品 "'+t+'"( '+e+") 投票失败")}),a.voted=a.voted+1,Object(f["a"])('作品 "'+t+'"( '+e+") 投票成功, 剩余可投票数 "+(a.max_votes-a.voted)+" 张"),a.$set(a.works[e],"voted",!0),a.$set(a.works[e],"btn_text","已投票"),a.max_votes<=a.voted&&(a.disable_all=!0)}).catch(function(){Object(c["a"])("取消投票")})},show_detail:function(e){this.selectedWorkTag=e,this.showDetailAction=!0},onActionClose:function(){this.showDetailAction=!1,this.selectedWorkTag="",Object(c["a"])("取消查看详情")},onContactDialogClose:function(){this.showContactDialog=!1},onActionSelect:function(e,t){if(this.showDetailAction=!1,"小程序内查看"===e){this.showLoadingDialog=!0;var n=this.works[this.selectedWorkTag]["pdf_url"];this.$router.push({name:"pdf",params:{pdf_src:n,openid:this.openid}}),this.showLoadingDialog=!1}else"作品链接"===e&&(this.subname=t,this.showContactDialog=!0);this.selectedWorkTag=""}}},m=h,v=n("2877"),g=Object(v["a"])(m,a,r,!1,null,null,null);t["default"]=g.exports},f54a:function(e,t,n){var o=n("0f5f"),a=new o;e.exports=a}}]);
//# sourceMappingURL=chunk-6195024c.cc2f3211.js.map