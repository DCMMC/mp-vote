(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0bcc1180"],{"0f5f":function(e,t,n){(function(t,n){e.exports=n()})(0,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";var o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports={type:function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},isObject:function(e,t){return t?"object"===this.type(e):e&&"object"===("undefined"===typeof e?"undefined":o(e))},isFormData:function(e){return"undefined"!==typeof FormData&&e instanceof FormData},trim:function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},encode:function(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")},formatParams:function(e){var t="",n=!0,o=this;if(!this.isObject(e))return e;function r(e,a){var i=o.encode,s=o.type(e);if("array"==s)e.forEach(function(e,t){o.isObject(e)||(t=""),r(e,a+"%5B"+t+"%5D")});else if("object"==s)for(var c in e)r(e[c],a?a+"%5B"+i(c)+"%5D":i(c));else n||(t+="&"),n=!1,t+=a+"="+i(e)}return r(e,""),t},merge:function(e,t){for(var n in t)e.hasOwnProperty(n)?this.isObject(t[n],1)&&this.isObject(e[n],1)&&this.merge(e[n],t[n]):e[n]=t[n];return e}}},,function(e,t,n){var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=n(0),i="undefined"!==typeof document,s=function(){function e(t){function n(e){var t=void 0,n=void 0;function o(){e.p=t=n=null}a.merge(e,{lock:function(){t||(e.p=new Promise(function(e,o){t=e,n=o}))},unlock:function(){t&&(t(),o())},clear:function(){n&&(n("cancel"),o())}})}r(this,e),this.engine=t||XMLHttpRequest,this.default=this;var o=this.interceptors={response:{use:function(e,t){this.handler=e,this.onerror=t}},request:{use:function(e){this.handler=e}}},i=o.request,s=o.response;n(s),n(i),this.config={method:"GET",baseURL:"",headers:{},timeout:0,params:{},parseJson:!0,withCredentials:!1}}return o(e,[{key:"request",value:function(e,t,n){var o=this,r=new this.engine,s="Content-Type",c=s.toLowerCase(),u=this.interceptors,l=u.request,f=u.response,d=l.handler,p=new Promise(function(u,p){function h(e){return e&&e.then&&e.catch}function m(e,t){e?e.then(function(){t()}):t()}function v(n){t=n.body,e=a.trim(n.url);var o=a.trim(n.baseURL||"");if(e||!i||o||(e=location.href),0!==e.indexOf("http")){var l="/"===e[0];if(!o&&i){var d=location.pathname.split("/");d.pop(),o=location.protocol+"//"+location.host+(l?"":d.join("/"))}if("/"!==o[o.length-1]&&(o+="/"),e=o+(l?e.substr(1):e),i){var v=document.createElement("a");v.href=e,e=v.href}}var g=a.trim(n.responseType||""),b=-1!==["GET","HEAD","DELETE","OPTION"].indexOf(n.method),w=a.type(t),y=n.params||{};b&&"object"===w&&(y=a.merge(t,y)),y=a.formatParams(y);var O=[];y&&O.push(y),b&&t&&"string"===w&&O.push(t),O.length>0&&(e+=(-1===e.indexOf("?")?"?":"&")+O.join("&")),r.open(n.method,e);try{r.withCredentials=!!n.withCredentials,r.timeout=n.timeout||0,"stream"!==g&&(r.responseType=g)}catch(T){}var j=n.headers[s]||n.headers[c],_="application/x-www-form-urlencoded";for(var x in a.trim((j||"").toLowerCase())===_?t=a.formatParams(t):a.isFormData(t)||-1===["object","array"].indexOf(a.type(t))||(_="application/json;charset=utf-8",t=JSON.stringify(t)),j||b||(n.headers[s]=_),n.headers)if(x===s&&a.isFormData(t))delete n.headers[x];else try{r.setRequestHeader(x,n.headers[x])}catch(T){}function k(e,t,o){m(f.p,function(){if(e){o&&(t.request=n);var r=e.call(f,t,Promise);t=void 0===r?t:r}h(t)||(t=Promise[0===o?"resolve":"reject"](t)),t.then(function(e){u(e)}).catch(function(e){p(e)})})}function C(e){e.engine=r,k(f.onerror,e,-1)}function D(e,t){this.message=e,this.status=t}r.onload=function(){try{var e=r.response||r.responseText;e&&n.parseJson&&-1!==(r.getResponseHeader(s)||"").indexOf("json")&&!a.isObject(e)&&(e=JSON.parse(e));var t=r.responseHeaders;if(!t){t={};var o=(r.getAllResponseHeaders()||"").split("\r\n");o.pop(),o.forEach(function(e){if(e){var n=e.split(":")[0];t[n]=r.getResponseHeader(n)}})}var i=r.status,c=r.statusText,u={data:e,headers:t,status:i,statusText:c};if(a.merge(u,r._response),i>=200&&i<300||304===i)u.engine=r,u.request=n,k(f.handler,u,0);else{var l=new D(c,i);l.response=u,C(l)}}catch(l){C(new D(l.msg,r.status))}},r.onerror=function(e){C(new D(e.msg||"Network Error",0))},r.ontimeout=function(){C(new D("timeout [ "+r.timeout+"ms ]",1))},r._options=n,setTimeout(function(){r.send(b?null:t)},0)}a.isObject(e)&&(n=e,e=n.url),n=n||{},n.headers=n.headers||{},m(l.p,function(){a.merge(n,JSON.parse(JSON.stringify(o.config)));var r=n.headers;r[s]=r[s]||r[c]||"",delete r[c],n.body=t||n.body,e=a.trim(e||""),n.method=n.method.toUpperCase(),n.url=e;var i=n;d&&(i=d.call(l,n,Promise)||n),h(i)||(i=Promise.resolve(i)),i.then(function(e){e===n?v(e):u(e)},function(e){p(e)})})});return p.engine=r,p}},{key:"all",value:function(e){return Promise.all(e)}},{key:"spread",value:function(e){return function(t){return e.apply(null,t)}}}]),e}();s.default=s,["get","post","put","patch","head","delete"].forEach(function(e){s.prototype[e]=function(t,n,o){return this.request(t,n,a.merge({method:e},o))}}),["lock","unlock","clear"].forEach(function(e){s.prototype[e]=function(){this.interceptors.request[e]()}}),e.exports=s}])})},a648:function(e,t,n){"use strict";n.r(t);var o,r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._l(e.works,function(t){return n("van-card",{key:t.tag,attrs:{tag:t.tag+" 号",desc:t.desc,title:t.title,thumb:t.imageURL}},[n("view",{attrs:{slot:"footer"},slot:"footer"},[n("van-button",{staticStyle:{"padding-right":"5px"},attrs:{size:"small",type:"danger",disabled:e.disable_all||t.voted,round:""},on:{click:function(n){return e.show_confirm_vote(t.tag,t.title,e.disable_all,t.voted)}}},[e._v("\n        "+e._s(t.btn_text)+"\n      ")]),n("van-button",{staticStyle:{"padding-left":"5px"},attrs:{size:"small",type:"primary",round:""},on:{click:function(n){return e.show_detail(t.tag)}}},[e._v("查看详情")])],1)])}),n("van-dialog",{attrs:{id:"van-dialog"}}),n("van-dialog",{attrs:{show:e.showContactDialog,"show-cancel-button":"","confirm-button-open-type":"contact",title:"提示",message:e.subname},on:{close:e.onContactDialogClose,cancel:e.onContactDialogClose}}),n("van-action-sheet",{attrs:{show:e.showDetailAction,title:"选择查看详情方式"},on:{close:function(t){return e.onActionClose()}}},[n("view",e._l(e.detailActions,function(t){return n("van-button",{key:t.name,attrs:{size:"large"},on:{click:function(n){return e.onActionSelect(t.name,t.subname)}}},[e._v("\n          "+e._s(t.name)+"\n        ")])}),1)]),n("van-notify",{attrs:{id:"van-notify"}}),n("van-toast",{attrs:{id:"van-toast"}})],2)},a=[],i=n("bd86"),s=(n("ac1e"),n("543e")),c=(n("e7e5"),n("d399")),u=(n("e17f"),n("2241")),l=(n("9a83"),n("f564")),f=n("f54a"),d={components:(o={},Object(i["a"])(o,l["a"].name,l["a"]),Object(i["a"])(o,u["a"].name,u["a"]),Object(i["a"])(o,c["a"].name,c["a"]),Object(i["a"])(o,s["a"].name,s["a"]),o),data:function(){return{deploy_domain:"https://vote.ilingyue.cn",userId:void 0,selectedWorkTag:"",showDetailAction:!1,showContactDialog:!1,disable_all:!1,max_votes:3,voted:0,subname:"",works:{}}},onLoad:function(e){this.userId=this.$root.$mp.query.userId},mounted:function(){Object(l["a"])("登录成功");var e=this;f.post(this.deploy_domain+"/getWorks",{userId:this.userId}).then(function(t){if(console.log(t),"success"===t["data"]["code"]){e.works=t["data"]["data"]["works"],e.max_votes=t["data"]["data"]["max_votes"],Object(l["a"])("获取作品成功");var n=0,o=e.works;for(var r in e.works)o[r]["voted"]?(n+=1,o[r]["btn_text"]="已投票"):o[r]["btn_text"]="直接投票";n>=e.max_votes&&(e.disable_all=!0),e.voted=n,e.works=o}else Object(l["a"])("获取作品失败")}).catch(function(e){console.log(e),Object(l["a"])("获取作品失败: "+e)})},computed:{detailActions:function(){return[{name:"小程序内查看",subname:"在小程序内打开作品的 pdf 版本介绍"},{name:"作品链接",subname:'在客服号中回复 "'+this.selectedWorkTag+'" 获得作品链接'}]}},methods:{show_confirm_vote:function(e,t,n,o){var r=this;n?Object(l["a"])("您已经使用完了所有票数("+this.voted+" 张)"):o?Object(l["a"])("您已经投票了该作品"):u["a"].confirm({title:"确认投票",message:'是否确认为作品 "'+t+'"('+e+") 投票, 投票后不能撤销!"}).then(function(){f.post(r.deploy_domain+"/vote",{user_id:r.userId,tag:e}).then(function(n){console.log(n),Object(l["a"])('作品 "'+t+'"( '+e+") 投票成功")}).catch(function(n){console.log(n),Object(l["a"])('作品 "'+t+'"( '+e+") 投票失败")}),r.voted=r.voted+1,Object(l["a"])('作品 "'+t+'"( '+e+") 投票成功, 剩余可投票数 "+(r.max_votes-r.voted)+" 张"),r.$set(r.works[e],"voted",!0),r.$set(r.works[e],"btn_text","已投票"),r.max_votes<=r.voted&&(r.disable_all=!0)}).catch(function(){Object(c["a"])("取消投票")})},show_detail:function(e){this.selectedWorkTag=e,this.showDetailAction=!0},onActionClose:function(){this.showDetailAction=!1,this.selectedWorkTag="",Object(c["a"])("取消查看详情")},onContactDialogClose:function(){this.showContactDialog=!1},onActionSelect:function(e,t){this.showDetailAction=!1,"小程序内查看"===e?(wx.showLoading({title:"文件下载中"}),wx.downloadFile({url:this.works[this.selectedWorkTag]["pdf_url"],success:function(e){var t=e.tempFilePath;wx.openDocument({filePath:t,success:function(e){wx.hideLoading(),console.log(e),console.log("打开文档成功")},fail:function(e){wx.hideLoading(),console.log(e),Object(l["a"])("打开文件失败")}})},fail:function(e){wx.hideLoading(),console.log(e),Object(l["a"])("下载文件失败")}})):"作品链接"===e&&(this.subname=t,this.showContactDialog=!0),this.selectedWorkTag=""}}},p=d,h=n("2877"),m=Object(h["a"])(p,r,a,!1,null,null,null);t["default"]=m.exports},f54a:function(e,t,n){var o=n("0f5f"),r=new o;e.exports=r}}]);
//# sourceMappingURL=chunk-0bcc1180.3eb72c66.js.map